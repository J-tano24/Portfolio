{% extends 'app/base.html' %}

{% block content %}

<div class="photo-detail">
  <span class="border-left-0" >
    <img src="{{ photo.image.url }}" alt="Responsive image" class="img-thumbnail shadow p-3 mb-5 bg-white rounded">
  </span>
  <div class="photo-info">
    <a href="{% url 'app:users_detail' photo.post_user.id %}">@{{ photo.post_user }}</a>
  </div>

  <h2>{{ photo.place_name }}</h2>
  
  <div class="point-fav-section">
    {% if request.user.is_authenticated %}
      <form action="{% url 'app:fav_photos_status' %}" method="post">{% csrf_token %}
        <input type="hidden" name="photo_id" value="{{ photo.id }}">
        {% if photo in user.fav_photos.all %}
          <input type="submit" name="submit" class="fav_button" value="お気に入りから外す"/> 
        {% else %}
          <input type="submit" name="submit" class="fav_button" value=" お気に入りに入れる" />
        {% endif %}
      </form>
    {% endif %}
  </div>

  <!-- 以下マップで詳細を表示 -->
  <div id="gmap" style="width: 100%; height: 500px;"></div>

  
  <script>

    var map;
    var marker;
    var infoWindow;
    
    function initMap() {;
      var gmap = document.getElementById('gmap');
      map = new google.maps.Map(gmap, {
        center: {lat: 52.215933, lng: 19.134422},
        zoom: 3.8,
        mapTypeId: 'hybrid',
        title: "here",
      });
      
      // 検索実行ボタンが押されたとき
      google.maps.event.addListener(map, 'click', function(e) {
        var marker = new google.maps.Marker({
        position: e.latLng,
        // （Geocoding：名称・地名・住所などの情報を、緯度経度の座標値に変換してくれる）Googleサーバーに送信するGecoderの新しいインスタンスを作成。
   
        map: this,  //this は map を意味します
         animation: google.maps.Animation.DROP
    });
 
    var infoWindow = new google.maps.InfoWindow({
      content: e.latLng.toString() //イベントの発生した位置を toString() で文字列に変換
    });
 
    //マーカーのイベント
    google.maps.event.addListener(marker, 'click', function() {
      infoWindow.open(map, marker); //marker の位置に情報ウィンドウを表示
    });
 
    //情報ウィンドウののイベント
    google.maps.event.addListener(infoWindow, 'closeclick', function() {
      marker.setMap(null);  //マーカーを削除
    });
  });
        
    }
    
    </script>
  
  <script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyAjtr9s7GMqEqGiCwbNBIBPsYVcSCfqZaw&callback=initMap" async defer></script>
  
  <!-- jQueryの組み込み -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  
  <!-- 削除ボタン -->
  <!-- アクセスしたユーザー＝この写真を投稿したユーザーの時だけ削除btnが表示されればいいのでその条件を書く。 -->
  {% if request.user == photo.user %}
  <form method="post" action="{% url 'app:photos_delete' photo.id %}">{% csrf_token %}
    <button class="btn" type="submit" onclick='return confirm("本当に削除しますか？");'>削除</button>
  </form>
  {% endif %}
  
  
</div>



{% endblock %}

