{% extends 'app/base.html' %}
{% block content %}

<div>
  <a href="{% url 'app:index' %}">ホームに戻る</a>
</div>
<!-- 画像ファイルをアップロードする際、formタグにenctype="multipart/form-data"をつけないとアップロードできないので要記載。 -->
<form action="{% url 'app:photos_new' %}" id="form" method="POST" enctype="multipart/form-data">{% csrf_token %}
  <table>
    <tr>
      <th>画像</th>
      <td>{{ form.image }}</td>
    </tr>
    <tr>
      <th>カテゴリー</th>
      <td>{{ form.category }}</td>
    </tr>
  </table>
  <!-- Djangoの書き方で.as_hiddenで画面上では隠すことができる。 -->
  {{ form.place_name.as_hidden }}
  {{ form.lat.as_hidden }}
  {{ form.lng.as_hidden }}  
  <button type="submit" class="btn" id="save">保存</button>
</form>

<b>Google Maps - 場所検索</b>
<p>※ここで検索する値は、名称として投稿画面で表示されます。</p>
<input type="text" id="keyword">
<button id="search">検索</button>
<button id="clear">クリア</button>
<div id="target" style="width: 700px; height: 500px;"></div>

<script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyAjtr9s7GMqEqGiCwbNBIBPsYVcSCfqZaw&callback=initMap" async defer></script>

<!-- jQueryの組み込み -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script>

  var map;
  var marker;
  var infoWindow;


  function initMap() {
    //マップ初期表示の位置設定
    // id="target"に対して、アクションをかける。※ここではマップ表示に備え、予め変数に代入している。
    var target = document.getElementById('target');
    // var target = $("#target") ←jQueryの書き方（targetの値を取得）
    var centerp = {lat: 52.215933, lng: 19.134422};

    //マップ表示
    map = new google.maps.Map(target, {
      center: centerp,
      zoom: 4,
    });

    // 検索実行ボタンが押されたとき
    google.maps.event.addListener(map, 'click', function(e) {
    var marker = new google.maps.Marker({
      position: e.latLng,  //イベントの発生した緯度・経度（位置）
      map: this,  //this は map を意味します
      animation: google.maps.Animation.DROP
    });
 
    var infoWindow = new google.maps.InfoWindow({
      content: e.latLng.toString() //イベントの発生した位置を toString() で文字列に変換
    });
 
    //マーカーのイベント
    google.maps.event.addListener(marker, 'click', function() {
      infoWindow.open(map, marker); //marker の位置に情報ウィンドウを表示
    });
 
    //情報ウィンドウののイベント
    google.maps.event.addListener(infoWindow, 'closeclick', function() {
      marker.setMap(null);  //マーカーを削除
    });
  });
  }
     

</script>

{% endblock %}